# 跳转指令 jmp

在介绍[递归](./递归.md)的时候，我们提到 `if` 语句被转换成了两条指令。

```c
 if(n <= 1)
 ...
 ```

 转换后的指令：

```arm
    0x55555555512d:       48 83 ff 01         cmp    $0x1,%rdi
    0x555555555131:       7f 06               jg     0x555555555139 <rfact+0x10>
    0x555555555133:       ...
```

[条件码](./条件码.md)一文中我们已经知道了 `cmp` 指令的具体含义，这次我们就来看看后面一句跳转指令。

## 跳转指令 JMP

编写的代码正常情况下会一句接着一句的顺序往下运行，但是如果遇到条件判断等情况，就需要根据条件的情况直接跳转到下一句需要运行的语句。

在高级语言中，我们可以使用 if 等判断语句，在指令集中没有直接对应的指令，我们可以使用的是跳转指令 `jmp`（Jump）。

### 直接跳转和间接跳转
`jmp` 是直接跳转指令，意思是直接跳转到后面操作数所对应的地址。

（图）

另外， `jmp` 还有一种间接跳转，写法是 `*`后面跟操作数：

```arm
jmp *%rax       //用 %rax 中的值作为操作目标

jmp *(%rax)     //以 %rax 中的值为地址，从内存中读取该地址中的值，并以该值为跳转目标。

```

### 条件跳转

`jmp` 指令直接进行跳转，并不读取条件码寄存器中的值。

[递归](./递归.md)示例中出现的 `jg` （jump greater）指令，则需要读取条件码寄存器中的值进行判断后再进行跳转。

类似 `jg` 这类的指令有很多，具体的条件和[之间文章](./条件码.md)中介绍的 `set` 指令一样。

只不过 `set` 指令是直接计算条件码寄存器中的判断结果，而 `j**` 则是根据判断结果进行跳转操作。

|指令|跳转条件|描述|
|:--|:--|:--|
|je Label|ZF|相等/零|
|jne Label|~ZF|不等/非零|
|js Label|SF|负数|
|jns Label|~SF|非负数|
|jg Label|~(SF^OF) & ~ZF|大于（有符号`>`）|
|jge Label|~(SF^OF)|大于等于（有符号`>=`）|
|jl Label|SF^OF |小于（有符号`<`）|
|jle Label|(SF^OF) &#124;  ZF|小于等于（有符号`<=`）|
|ja Label|~CF & ~ZF |大于（无符号`>`）|
|jae Label|~CF |大于等于（无符号`>=`）|
|jb Label|CF|小于（无符号`<`）|
|jbe Label|CF &#124;  ZF|小于等于（无符号`<=`）|

现在我们基本可以明白，之前的指令是什么意思了。

```arm
cmp    $0x1,%rdi
jg     0x555555555139 <rfact+0x10>
```

如果 `%rdi > 1`，就跳转到指令 `0x555555555139`。

## 跳转指令的编码

在之前的文章中，我们只关注指令，并没有关心指令的编码的细节。

```arm
    0x55555555512d:       48 83 ff 01         cmp    $0x1,%rdi
    0x555555555131:       7f 06               jg     0x555555555139 <rfact+0x10>
    0x555555555133:       ...
```

比如在上面的示例中，`jg     0x555555555139 <rfact+0x10>`指令的编码为 `7f 06`。

指令编码的细节，在第四章会有介绍。这里只是简单了解一下，`7f` 代表的是 `jg` 指令，那么 `06` 是如何代表跳转地址 `0x555555555139` 的呢？

（图）





